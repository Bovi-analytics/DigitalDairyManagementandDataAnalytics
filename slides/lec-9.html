<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <meta name="dcterms.date" content="2025-03-17">
  <title>Beasts &amp; Bytes – Data transformations</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-534cd8e3a96973385dffff3f4709048d.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<meta property="og:title" content="Data transformations – Beasts &amp; Bytes">
<meta property="og:description" content="Lecture 9">
<meta property="og:site_name" content="Beasts &amp; Bytes">
<meta name="twitter:title" content="Data transformations – Beasts &amp; Bytes">
<meta name="twitter:description" content="Lecture 9">
<meta name="twitter:image" content="https://bovi-analytics.github.io/BeastAndBytes/slides/images/twitter-card.png">
<meta name="twitter:creator" content="@MielHostens">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Data transformations</h1>
  <p class="subtitle">Lecture 9</p>

<div class="quarto-title-authors">
</div>

  <p class="date">2025-03-17</p>
</section>
<section>
<section id="sec-warm-up" class="title-slide slide level1 center">
<h1>Warm up</h1>

</section>
<section id="sec-setup" class="slide level2">
<h2>Setup</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section></section>
<section>
<section id="sec-introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="sec-prerequisites" class="slide level2">
<h2>Prerequisites</h2>
<ul>
<li>Numeric vectors are the backbone of data science</li>
<li>But we still need the tidyverse because we’ll use these base R functions inside of tidyverse functions like <code>mutate()</code> and <code>filter()</code>.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a></a><span class="fu">library</span>(nycflights13)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-making-numbers" class="slide level2">
<h2>Making numbers</h2>
<p>In most cases, you’ll get numbers already recorded in one of R’s numeric types:</p>
<ul>
<li><p>integer</p></li>
<li><p>double.</p></li>
</ul>
<p>In some cases, however, you’ll encounter them as strings, possibly because you’ve created them by pivoting from column headers or because something has gone wrong in your data import process.</p>
</section>
<section id="sec-parsing-numbers" class="slide level2">
<h2>Parsing numbers</h2>
<p>readr provides two useful functions for parsing strings into numbers: <code>parse_double()</code> and <code>parse_number()</code>. Use <code>parse_double()</code> when you have numbers that have been written as strings:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1.2"</span>, <span class="st">"5.6"</span>, <span class="st">"1e3"</span>)</span>
<span id="cb3-2"><a></a><span class="fu">parse_double</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    1.2    5.6 1000.0</code></pre>
</div>
</div>
<p>Use <code>parse_number()</code> when the string contains non-numeric text that you want to ignore. This is particularly useful for currency data and percentages:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"$1,234"</span>, <span class="st">"USD 3,513"</span>, <span class="st">"59%"</span>)</span>
<span id="cb5-2"><a></a><span class="fu">parse_number</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1234 3513   59</code></pre>
</div>
</div>
</section></section>
<section>
<section id="sec-counts" class="title-slide slide level1 center">
<h1>Counts</h1>
<p>The <code>dplyr::count()</code> is great for quick exploration and checks during analysis:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>flights <span class="sc">|&gt;</span> <span class="fu">count</span>(dest)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 2
   dest      n
   &lt;chr&gt; &lt;int&gt;
 1 ABQ     254
 2 ACK     265
 3 ALB     439
 4 ANC       8
 5 ATL   17215
 6 AUS    2439
 7 AVL     275
 8 BDL     443
 9 BGR     375
10 BHM     297
# ℹ 95 more rows</code></pre>
</div>
</div>
</section>
<section id="sec-counts-2" class="slide level2">
<h2>Counts</h2>
<p>If you want to see the most common values, add <code>sort = TRUE</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>flights <span class="sc">|&gt;</span> <span class="fu">count</span>(dest, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 2
   dest      n
   &lt;chr&gt; &lt;int&gt;
 1 ORD   17283
 2 ATL   17215
 3 LAX   16174
 4 BOS   15508
 5 MCO   14082
 6 CLT   14064
 7 SFO   13331
 8 FLL   12055
 9 MIA   11728
10 DCA    9705
# ℹ 95 more rows</code></pre>
</div>
</div>
<p>If you want to see all the values:</p>
<ul>
<li><p><code>|&gt; View()</code></p></li>
<li><p><code>|&gt; print(n = Inf)</code>.</p></li>
</ul>
</section>
<section id="sec-counts-3" class="slide level2">
<h2>Counts alternative</h2>
<p>Same computation “by hand” with <code>group_by()</code>, <code>summarize()</code> and <code>n()</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a></a>  <span class="fu">group_by</span>(dest) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a></a>  <span class="fu">summarize</span>(</span>
<span id="cb11-4"><a></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb11-5"><a></a>    <span class="at">delay =</span> <span class="fu">mean</span>(arr_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 3
   dest      n delay
   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;
 1 ABQ     254  4.38
 2 ACK     265  4.85
 3 ALB     439 14.4 
 4 ANC       8 -2.5 
 5 ATL   17215 11.3 
 6 AUS    2439  6.02
 7 AVL     275  8.00
 8 BDL     443  7.05
 9 BGR     375  8.03
10 BHM     297 16.9 
# ℹ 95 more rows</code></pre>
</div>
</div>
</section>
<section id="sec-counts-4" class="slide level2">
<h2>Count distinct</h2>
<p>There are a couple of variants of <code>n()</code> and <code>count()</code> that you might find useful:</p>
<ul>
<li><p><code>n_distinct(x)</code> counts the number of distinct (unique) values of one or more variables. For example, we could figure out which destinations are served by the most carriers:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a></a>  <span class="fu">group_by</span>(dest) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a></a>  <span class="fu">summarize</span>(<span class="at">carriers =</span> <span class="fu">n_distinct</span>(carrier)) <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(carriers))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 2
   dest  carriers
   &lt;chr&gt;    &lt;int&gt;
 1 ATL          7
 2 BOS          7
 3 CLT          7
 4 ORD          7
 5 TPA          7
 6 AUS          6
 7 DCA          6
 8 DTW          6
 9 IAD          6
10 MSP          6
# ℹ 95 more rows</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="sec-counts-5" class="slide level2">
<h2>Weighted count</h2>
<ul>
<li><p>A weighted count is a sum. For example you could “count” the number of miles each plane flew:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a></a>  <span class="fu">group_by</span>(tailnum) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a></a>  <span class="fu">summarize</span>(<span class="at">miles =</span> <span class="fu">sum</span>(distance))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,044 × 2
   tailnum  miles
   &lt;chr&gt;    &lt;dbl&gt;
 1 D942DN    3418
 2 N0EGMQ  250866
 3 N10156  115966
 4 N102UW   25722
 5 N103US   24619
 6 N104UW   25157
 7 N10575  150194
 8 N105UW   23618
 9 N107US   21677
10 N108UW   32070
# ℹ 4,034 more rows</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="sec-counts-6" class="slide level2">
<h2>Weighted count</h2>
<p>Weighted counts are a common problem so <code>count()</code> has a <code>wt</code> argument that does the same thing:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a></a><span class="in">```{r}</span></span>
<span id="cb17-2"><a></a><span class="co">#| results: false</span></span>
<span id="cb17-3"><a></a>flights <span class="sc">|&gt;</span> <span class="fu">count</span>(tailnum, <span class="at">wt =</span> distance)</span>
<span id="cb17-4"><a></a><span class="in">```</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="sec-counts-7" class="slide level2">
<h2>Counts missing</h2>
<ul>
<li><p>You can count missing values by combining <code>sum()</code> and <code>is.na()</code>. In the <code>flights</code> dataset this represents flights that are cancelled:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a></a>  <span class="fu">group_by</span>(dest) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a></a>  <span class="fu">summarize</span>(<span class="at">n_cancelled =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(dep_time))) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 105 × 2
   dest  n_cancelled
   &lt;chr&gt;       &lt;int&gt;
 1 ABQ             0
 2 ACK             0
 3 ALB            20
 4 ANC             0
 5 ATL           317
 6 AUS            21
 7 AVL            12
 8 BDL            31
 9 BGR            15
10 BHM            25
# ℹ 95 more rows</code></pre>
</div>
</div></li>
</ul>
</section></section>
<section>
<section id="sec-numeric-transformations" class="title-slide slide level1 center">
<h1>Numeric transformations</h1>
<p>Transformation functions work well with <code>mutate()</code> because their output is the same length as the input.</p>
</section>
<section id="sec-minimum-and-maximum-1" class="slide level2">
<h2>Minimum and maximum</h2>
<p>The arithmetic functions work with pairs of variables (or columns). Two closely related functions are <code>pmin()</code> and <code>pmax()</code>, which when given two or more variables will return the smallest or largest value in each row:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb20-2"><a></a>  <span class="sc">~</span>x, <span class="sc">~</span>y,</span>
<span id="cb20-3"><a></a>  <span class="dv">1</span>,  <span class="dv">3</span>,</span>
<span id="cb20-4"><a></a>  <span class="dv">5</span>,  <span class="dv">2</span>,</span>
<span id="cb20-5"><a></a>  <span class="dv">7</span>, <span class="cn">NA</span>,</span>
<span id="cb20-6"><a></a>)</span>
<span id="cb20-7"><a></a></span>
<span id="cb20-8"><a></a>df <span class="sc">|&gt;</span> </span>
<span id="cb20-9"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-10"><a></a>    <span class="at">min =</span> <span class="fu">pmin</span>(x, y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-11"><a></a>    <span class="at">max =</span> <span class="fu">pmax</span>(x, y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-12"><a></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
      x     y   min   max
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     3     1     3
2     5     2     2     5
3     7    NA     7     7</code></pre>
</div>
</div>
</section>
<section id="sec-minimum-and-maximum-2" class="slide level2">
<h2>Minimum and maximum</h2>
<p>Note that these are different to the summary functions <code>min()</code> and <code>max()</code> which take multiple observations and return a single value. You can tell that you’ve used the wrong form when all the minimums and all the maximums have the same value:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>df <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-3"><a></a>    <span class="at">min =</span> <span class="fu">min</span>(x, y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-4"><a></a>    <span class="at">max =</span> <span class="fu">max</span>(x, y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-5"><a></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
      x     y   min   max
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     3     1     7
2     5     2     1     7
3     7    NA     1     7</code></pre>
</div>
</div>
</section>
<section id="sec-modular-arithmetic-1" class="slide level2">
<h2>Modular arithmetic</h2>
<p>Modular arithmetic is the technical name for the type of math you did before you learned about decimal places, i.e.&nbsp;division that yields a whole number and a remainder. In R, <code>%/%</code> does integer division and <code>%%</code> computes the remainder:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%/%</span> <span class="dv">3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 1 1 1 2 2 2 3 3</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">%%</span> <span class="dv">3</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 2 0 1 2 0 1 2 0 1</code></pre>
</div>
</div>
</section>
<section id="sec-modular-arithmetic-2" class="slide level2">
<h2>Modular arithmetic</h2>
<p>Modular arithmetic is handy for the <code>flights</code> dataset, because we can use it to unpack the <code>sched_dep_time</code> variable into <code>hour</code> and <code>minute</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-3"><a></a>    <span class="at">hour =</span> sched_dep_time <span class="sc">%/%</span> <span class="dv">100</span>,</span>
<span id="cb28-4"><a></a>    <span class="at">minute =</span> sched_dep_time <span class="sc">%%</span> <span class="dv">100</span>,</span>
<span id="cb28-5"><a></a>    <span class="at">.keep =</span> <span class="st">"used"</span></span>
<span id="cb28-6"><a></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 3
   sched_dep_time  hour minute
            &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1            515     5     15
 2            529     5     29
 3            540     5     40
 4            545     5     45
 5            600     6      0
 6            558     5     58
 7            600     6      0
 8            600     6      0
 9            600     6      0
10            600     6      0
# ℹ 336,766 more rows</code></pre>
</div>
</div>
</section>
<section id="sec-modular-arithmetic-3" class="slide level2">
<h2>Modular arithmetic</h2>
<p>We can combine that with the <code>mean(is.na(x))</code> trick from <strong>?@sec-logical-summaries</strong> to see how the proportion of cancelled flights varies over the course of the day. The results are shown in <a href="#/fig-prop-cancelled" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a></a>  <span class="fu">group_by</span>(<span class="at">hour =</span> sched_dep_time <span class="sc">%/%</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a></a>  <span class="fu">summarize</span>(<span class="at">prop_cancelled =</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(dep_time)), <span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a></a>  <span class="fu">filter</span>(hour <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> prop_cancelled)) <span class="sc">+</span></span>
<span id="cb30-6"><a></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"grey50"</span>) <span class="sc">+</span> </span>
<span id="cb30-7"><a></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="lec-9_files/figure-revealjs/fig-prop-cancelled-1.png" alt="A line plot showing how proportion of cancelled flights changes over the course of the day. The proportion starts low at around 0.5% at 5am, then steadily increases over the course of the day until peaking at 4% at 7pm. The proportion of cancelled flights then drops rapidly getting down to around 1% by midnight." width="960" class="r-stretch quarto-figure-center" id="fig-prop-cancelled"><p class="caption">
Figure&nbsp;1: A line plot with scheduled departure hour on the x-axis, and proportion of cancelled flights on the y-axis. Cancellations seem to accumulate over the course of the day until 8pm, very late flights are much less likely to be cancelled.
</p></section></section>
<section>
<section id="sec-logarithms" class="title-slide slide level1 center">
<h1>Logarithms</h1>

</section>
<section id="sec-three-logarithms" class="slide level2">
<h2>Three logarithms</h2>
<p>In R, you have a choice of three logarithms:</p>
<ul>
<li><p><code>log()</code> (the natural log, base e),</p></li>
<li><p><code>log2()</code> (base 2),</p></li>
<li><p><code>log10()</code> (base 10).</p></li>
</ul>
</section>
<section id="sec-logarithm-recommendation" class="slide level2">
<h2>Logarithm recommendation</h2>
<p>We recommend using <code>log2()</code> or <code>log10()</code>:</p>
<ul>
<li><p><code>log2()</code> is easy to interpret because a difference of 1 on the log scale corresponds to doubling on the original scale and a difference of -1 corresponds to halving;</p></li>
<li><p><code>log10()</code> is easy to back-transform because (e.g.) 3 is 10^3 = 1000.</p></li>
</ul>
<p>The inverse of <code>log()</code> is <code>exp()</code>; to compute the inverse of <code>log2()</code> or <code>log10()</code> you’ll need to use <code>2^</code> or <code>10^</code>.</p>
</section>
<section id="sec-rounding" class="slide level2">
<h2>Rounding</h2>
<p>Use <code>round(x)</code> to round a number to the nearest integer:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="fu">round</span>(<span class="fl">123.456</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123</code></pre>
</div>
</div>
</section>
<section id="sec-rounding-digits" class="slide level2">
<h2>Rounding digits</h2>
<p>You can control the precision of the rounding with the second argument, <code>digits</code>. <code>round(x, digits)</code> rounds to the nearest <code>10^-n</code> so <code>digits = 2</code> will round to the nearest 0.01. This definition is useful because it implies <code>round(x, -3)</code> will round to the nearest thousand, which indeed it does:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a><span class="fu">round</span>(<span class="fl">123.456</span>, <span class="dv">2</span>)  <span class="co"># two digits</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123.46</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a><span class="fu">round</span>(<span class="fl">123.456</span>, <span class="dv">1</span>)  <span class="co"># one digit</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123.5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a><span class="fu">round</span>(<span class="fl">123.456</span>, <span class="sc">-</span><span class="dv">1</span>) <span class="co"># round to nearest ten</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 120</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a><span class="fu">round</span>(<span class="fl">123.456</span>, <span class="sc">-</span><span class="dv">2</span>) <span class="co"># round to nearest hundred</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
</div>
</section>
<section id="sec-rounding-digits---weirdness" class="slide level2">
<h2>Rounding digits - weirdness</h2>
<p>There’s one weirdness with <code>round()</code> that seems surprising at first glance:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a><span class="fu">round</span>(<span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 2</code></pre>
</div>
</div>
<p><code>round()</code> uses what’s known as “round half to even” or Banker’s rounding: if a number is half way between two integers, it will be rounded to the <strong>even</strong> integer. This is a good strategy because it keeps the rounding unbiased: half of all 0.5s are rounded up, and half are rounded down.</p>
</section>
<section id="sec-rounding-digits---floorceiling" class="slide level2">
<h2>Rounding digits - floor/ceiling</h2>
<p><code>round()</code> is paired with <code>floor()</code> which always rounds down and <code>ceiling()</code> which always rounds up:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a>x <span class="ot">&lt;-</span> <span class="fl">123.456</span></span>
<span id="cb43-2"><a></a></span>
<span id="cb43-3"><a></a><span class="fu">floor</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 123</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a><span class="fu">ceiling</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 124</code></pre>
</div>
</div>
</section>
<section id="sec-cutting-numbers-into-ranges-1" class="slide level2">
<h2>Cutting numbers into ranges</h2>
<p>Use <code>cut()</code><sup>1</sup> to break up (aka bin) a numeric vector into discrete buckets:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb47-2"><a></a>x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  2  5 10 15 20</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a><span class="fu">cut</span>(x, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] (0,5]   (0,5]   (0,5]   (5,10]  (10,15] (15,20]
Levels: (0,5] (5,10] (10,15] (15,20]</code></pre>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>ggplot2 provides some helpers for common cases in <code>cut_interval()</code>, <code>cut_number()</code>, and <code>cut_width()</code>. ggplot2 is an admittedly weird place for these functions to live, but they are useful as part of histogram computation and were written before any other parts of the tidyverse existed.</p></li></ol></aside></section>
<section id="sec-cutting-numbers-into-ranges-2" class="slide level2">
<h2>Cutting numbers into ranges</h2>
<p>The breaks don’t need to be evenly spaced:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a><span class="fu">cut</span>(x, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">100</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] (0,5]    (0,5]    (0,5]    (5,10]   (10,100] (10,100]
Levels: (0,5] (5,10] (10,100]</code></pre>
</div>
</div>
</section>
<section id="sec-cutting-numbers-into-ranges-3" class="slide level2">
<h2>Cutting numbers into ranges</h2>
<p>You can optionally supply your own <code>labels</code>. Note that there should be one less <code>labels</code> than <code>breaks</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a><span class="fu">cut</span>(x, </span>
<span id="cb53-2"><a></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>), </span>
<span id="cb53-3"><a></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"sm"</span>, <span class="st">"md"</span>, <span class="st">"lg"</span>, <span class="st">"xl"</span>)</span>
<span id="cb53-4"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] sm sm sm md lg xl
Levels: sm md lg xl</code></pre>
</div>
</div>
</section>
<section id="sec-cutting-numbers-into-ranges-4" class="slide level2">
<h2>Cutting numbers into ranges</h2>
<p>Any values outside of the range of the breaks will become <code>NA</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="sc">-</span><span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">30</span>)</span>
<span id="cb55-2"><a></a><span class="fu">cut</span>(y, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] &lt;NA&gt;   &lt;NA&gt;   (0,5]  (5,10] &lt;NA&gt;  
Levels: (0,5] (5,10] (10,15] (15,20]</code></pre>
</div>
</div>
<p>See the documentation for other useful arguments like <code>right</code> and <code>include.lowest</code>, which control if the intervals are <code>[a, b)</code> or <code>(a, b]</code> and if the lowest interval should be <code>[a, b]</code>.</p>
</section>
<section id="sec-cumulative-and-rolling-aggregates" class="slide level2">
<h2>Cumulative and rolling aggregates</h2>
<p>Base R provides <code>cumsum()</code>, <code>cumprod()</code>, <code>cummin()</code>, <code>cummax()</code> for running, or cumulative, sums, products, mins and maxes. dplyr provides <code>cummean()</code> for cumulative means. Cumulative sums tend to come up the most in practice:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb57-2"><a></a>x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a></a><span class="fu">cumprod</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]       1       2       6      24     120     720    5040   40320  362880
[10] 3628800</code></pre>
</div>
</div>
<p>If you need more complex rolling or sliding aggregates, try the <a href="https://slider.r-lib.org/">slider</a> package.</p>
</section></section>
<section>
<section id="sec-general-transformations" class="title-slide slide level1 center">
<h1>General transformations</h1>
<p>The following sections describe some general transformations which are often used with numeric vectors, but can be applied to all other column types.</p>
</section>
<section id="sec-ranks-1" class="slide level2">
<h2>Ranks</h2>
<p>dplyr provides a number of ranking functions inspired by SQL, but you should always start with <code>dplyr::min_rank()</code>. It uses the typical method for dealing with ties, e.g., 1st, 2nd, 2nd, 4th.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">20</span>, <span class="dv">15</span>, <span class="cn">NA</span>)</span>
<span id="cb61-2"><a></a><span class="fu">min_rank</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  4  2  2  5  7  6 NA</code></pre>
</div>
</div>
</section>
<section id="sec-ranks-2" class="slide level2">
<h2>Ranks</h2>
<p>Note that the smallest values get the lowest ranks; use <code>desc(x)</code> to give the largest values the smallest ranks:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a></a><span class="fu">min_rank</span>(<span class="fu">desc</span>(x))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  7  4  5  5  3  1  2 NA</code></pre>
</div>
</div>
</section>
<section id="sec-ranks-alternatives" class="slide level2">
<h2>Ranks alternatives</h2>
<p>If <code>min_rank()</code> doesn’t do what you need, look at the variants <code>dplyr::row_number()</code>, <code>dplyr::dense_rank()</code>, <code>dplyr::percent_rank()</code>, and <code>dplyr::cume_dist()</code>. See the documentation for details.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> x)</span>
<span id="cb65-2"><a></a>df <span class="sc">|&gt;</span> </span>
<span id="cb65-3"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-4"><a></a>    <span class="at">row_number =</span> <span class="fu">row_number</span>(x),</span>
<span id="cb65-5"><a></a>    <span class="at">dense_rank =</span> <span class="fu">dense_rank</span>(x),</span>
<span id="cb65-6"><a></a>    <span class="at">percent_rank =</span> <span class="fu">percent_rank</span>(x),</span>
<span id="cb65-7"><a></a>    <span class="at">cume_dist =</span> <span class="fu">cume_dist</span>(x)</span>
<span id="cb65-8"><a></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
      x row_number dense_rank percent_rank cume_dist
  &lt;dbl&gt;      &lt;int&gt;      &lt;int&gt;        &lt;dbl&gt;     &lt;dbl&gt;
1     1          1          1        0         0.143
2     3          4          3        0.5       0.571
3     2          2          2        0.167     0.429
4     2          3          2        0.167     0.429
5     4          5          4        0.667     0.714
6    20          7          6        1         1    
7    15          6          5        0.833     0.857
8    NA         NA         NA       NA        NA    </code></pre>
</div>
</div>
</section>
<section id="sec-offsets" class="slide level2">
<h2>Offsets</h2>
<p><code>dplyr::lead()</code> and <code>dplyr::lag()</code> allow you to refer to the values just before or just after the “current” value. They return a vector of the same length as the input, padded with <code>NA</code>s at the start or end:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">11</span>, <span class="dv">11</span>, <span class="dv">19</span>, <span class="dv">35</span>)</span>
<span id="cb67-2"><a></a><span class="fu">lag</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA  2  5 11 11 19</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a></a><span class="fu">lead</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  5 11 11 19 35 NA</code></pre>
</div>
</div>
</section>
<section id="sec-offsets---lag" class="slide level2">
<h2>Offsets - lag</h2>
<ul>
<li><p><code>x - lag(x)</code> gives you the difference between the current and previous value.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a></a>x <span class="sc">-</span> <span class="fu">lag</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA  3  6  0  8 16</code></pre>
</div>
</div></li>
<li><p><code>x == lag(x)</code> tells you when the current value changes.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a></a>x <span class="sc">==</span> <span class="fu">lag</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    NA FALSE FALSE  TRUE FALSE FALSE</code></pre>
</div>
</div></li>
</ul>
<p>You can lead or lag by more than one position by using the second argument, <code>n</code>.</p>
</section>
<section id="sec-consecutive-identifiers-1" class="slide level2">
<h2>Consecutive identifiers</h2>
<p>Sometimes you want to start a new group every time some event occurs. For example, when you’re looking at website data, it’s common to want to break up events into sessions, where you begin a new session after a gap of more than <code>x</code> minutes since the last activity. For example, imagine you have the times when someone visited a website:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a></a>events <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb75-2"><a></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">30</span>)</span>
<span id="cb75-3"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-consecutive-identifiers-2" class="slide level2">
<h2>Consecutive identifiers</h2>
<p>And you’ve computed the time between each event, and figured out if there’s a gap that’s big enough to qualify:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a></a>events <span class="ot">&lt;-</span> events <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb76-3"><a></a>    <span class="at">diff =</span> time <span class="sc">-</span> <span class="fu">lag</span>(time, <span class="at">default =</span> <span class="fu">first</span>(time)),</span>
<span id="cb76-4"><a></a>    <span class="at">has_gap =</span> diff <span class="sc">&gt;=</span> <span class="dv">5</span></span>
<span id="cb76-5"><a></a>  )</span>
<span id="cb76-6"><a></a>events</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
    time  diff has_gap
   &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;  
 1     0     0 FALSE  
 2     1     1 FALSE  
 3     2     1 FALSE  
 4     3     1 FALSE  
 5     5     2 FALSE  
 6    10     5 TRUE   
 7    12     2 FALSE  
 8    15     3 FALSE  
 9    17     2 FALSE  
10    19     2 FALSE  
11    20     1 FALSE  
12    27     7 TRUE   
13    28     1 FALSE  
14    30     2 FALSE  </code></pre>
</div>
</div>
</section>
<section id="sec-consecutive-identifiers-3" class="slide level2">
<h2>Consecutive identifiers</h2>
<p>But how do we go from that logical vector to something that we can <code>group_by()</code>? <code>cumsum()</code>, from <a href="#/sec-cumulative-and-rolling-aggregates" class="quarto-xref">Section&nbsp;5.11</a>, comes to the rescue as gap, i.e.&nbsp;<code>has_gap</code> is <code>TRUE</code>, will increment <code>group</code> by one (<strong>?@sec-numeric-summaries-of-logicals</strong>):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a></a>events <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb78-2"><a></a>  <span class="at">group =</span> <span class="fu">cumsum</span>(has_gap)</span>
<span id="cb78-3"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
    time  diff has_gap group
   &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;   &lt;int&gt;
 1     0     0 FALSE       0
 2     1     1 FALSE       0
 3     2     1 FALSE       0
 4     3     1 FALSE       0
 5     5     2 FALSE       0
 6    10     5 TRUE        1
 7    12     2 FALSE       1
 8    15     3 FALSE       1
 9    17     2 FALSE       1
10    19     2 FALSE       1
11    20     1 FALSE       1
12    27     7 TRUE        2
13    28     1 FALSE       2
14    30     2 FALSE       2</code></pre>
</div>
</div>
</section>
<section id="sec-consecutive-identifiers-4" class="slide level2">
<h2>Consecutive identifiers</h2>
<p>Another approach for creating grouping variables is <code>consecutive_id()</code>, which starts a new group every time one of its arguments changes. For example, inspired by <a href="https://stackoverflow.com/questions/27482712">this stackoverflow question</a>, imagine you have a data frame with a bunch of repeated values:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-2"><a></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>),</span>
<span id="cb80-3"><a></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">199</span>)</span>
<span id="cb80-4"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="sec-consecutive-identifiers-5" class="slide level2">
<h2>Consecutive identifiers</h2>
<p>If you want to keep the first row from each repeated <code>x</code>, you could use <code>group_by()</code>, <code>consecutive_id()</code>, and <code>slice_head()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a></a>df <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a></a>  <span class="fu">group_by</span>(<span class="at">id =</span> <span class="fu">consecutive_id</span>(x)) <span class="sc">|&gt;</span> </span>
<span id="cb81-3"><a></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
# Groups:   id [7]
  x         y    id
  &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;
1 a         1     1
2 b         2     2
3 c         4     3
4 d         3     4
5 e         9     5
6 a         4     6
7 b        10     7</code></pre>
</div>
</div>
</section></section>
<section>
<section id="sec-numeric-summaries" class="title-slide slide level1 center">
<h1>Numeric summaries</h1>
<p>Just using the counts, means, and sums that we’ve introduced already can get you a long way, but R provides many other useful summary functions. Here is a selection that you might find useful.</p>
</section>
<section id="sec-center" class="slide level2">
<h2>Center</h2>
<ul>
<li>Function <code>mean()</code></li>
<li>Function <code>median()</code></li>
</ul>
</section>
<section id="sec-minimum-maximum-and-quantiles-1" class="slide level2">
<h2>Minimum, maximum, and quantiles</h2>
<ul>
<li><code>min()</code> and <code>max()</code> will give you the largest and smallest values.</li>
<li>Another powerful tool is <code>quantile()</code> which is a generalization of the median:
<ul>
<li><code>quantile(x, 0.25)</code> will find the value of <code>x</code> that is greater than 25% of the values,</li>
<li><code>quantile(x, 0.5)</code> is equivalent to the median,</li>
<li><code>quantile(x, 0.95)</code> will find the value that’s greater than 95% of the values.</li>
</ul></li>
</ul>
</section>
<section id="sec-minimum-maximum-and-quantiles-2" class="slide level2">
<h2>Minimum, maximum, and quantiles</h2>
<p>For the <code>flights</code> data, you might want to look at the 95% quantile of delays rather than the maximum, because it will ignore the 5% of most delayed flights which can be quite extreme.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">|&gt;</span></span>
<span id="cb83-3"><a></a>  <span class="fu">summarize</span>(</span>
<span id="cb83-4"><a></a>    <span class="at">max =</span> <span class="fu">max</span>(dep_delay, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb83-5"><a></a>    <span class="at">q95 =</span> <span class="fu">quantile</span>(dep_delay, <span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb83-6"><a></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb83-7"><a></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 5
    year month   day   max   q95
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  2013     1     1   853  70.1
 2  2013     1     2   379  85  
 3  2013     1     3   291  68  
 4  2013     1     4   288  60  
 5  2013     1     5   327  41  
 6  2013     1     6   202  51  
 7  2013     1     7   366  51.6
 8  2013     1     8   188  35.3
 9  2013     1     9  1301  27.2
10  2013     1    10  1126  31  
# ℹ 355 more rows</code></pre>
</div>
</div>
</section>
<section id="sec-variation" class="slide level2">
<h2>Variation</h2>
<p>Two commonly used summaries are</p>
<ul>
<li><p>the standard deviation <code>sd(x)</code>,</p></li>
<li><p>the inter-quartile range, <code>IQR()</code>.</p></li>
</ul>
</section>
<section id="sec-positions" class="slide level2">
<h2>Positions</h2>
<p>There’s one final type of summary that’s useful for numeric vectors, but also works with every other type of value: extracting a value at a specific position:</p>
<ul>
<li><p><code>first(x)</code>,</p></li>
<li><p><code>last(x)</code>, and</p></li>
<li><p><code>nth(x, n)</code>.</p></li>
</ul>
</section>
<section id="sec-positions-2" class="slide level2">
<h2>Positions</h2>
<p>For example, we can find the first, fifth and last departure for each day:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a></a>  <span class="fu">group_by</span>(year, month, day) <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a></a>  <span class="fu">summarize</span>(</span>
<span id="cb85-4"><a></a>    <span class="at">first_dep =</span> <span class="fu">first</span>(dep_time, <span class="at">na_rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb85-5"><a></a>    <span class="at">fifth_dep =</span> <span class="fu">nth</span>(dep_time, <span class="dv">5</span>, <span class="at">na_rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb85-6"><a></a>    <span class="at">last_dep =</span> <span class="fu">last</span>(dep_time, <span class="at">na_rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-7"><a></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year', 'month'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 6
# Groups:   year, month [12]
    year month   day first_dep fifth_dep last_dep
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;    &lt;int&gt;
 1  2013     1     1       517       554     2356
 2  2013     1     2        42       535     2354
 3  2013     1     3        32       520     2349
 4  2013     1     4        25       531     2358
 5  2013     1     5        14       534     2357
 6  2013     1     6        16       555     2355
 7  2013     1     7        49       536     2359
 8  2013     1     8       454       544     2351
 9  2013     1     9         2       524     2252
10  2013     1    10         3       530     2320
# ℹ 355 more rows</code></pre>
</div>
</div>
<p>NB: Because dplyr functions use <code>_</code> to separate components of function and arguments names, these functions use <code>na_rm</code> instead of <code>na.rm</code>.</p>
</section>
<section id="sec-with-mutate" class="slide level2">
<h2>With <code>mutate()</code></h2>
<p>As the names suggest, the summary functions are typically paired with <code>summarize()</code>. However, because of the recycling rules we discussed in <strong>?@sec-recycling</strong> they can also be usefully paired with <code>mutate()</code>, particularly when you want do some sort of group standardization. For example:</p>
<ul>
<li><code>x / sum(x)</code> calculates the proportion of a total.</li>
<li><code>(x - mean(x)) / sd(x)</code> computes a Z-score (standardized to mean 0 and sd 1).</li>
<li><code>(x - min(x)) / (max(x) - min(x))</code> standardizes to range [0, 1].</li>
<li><code>x / first(x)</code> computes an index based on the first observation.</li>
</ul>


</section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><a href="https://bovi-analytics.github.io/BeastsAndBytes/">https://bovi-analytics.github.io/BeastsAndBytes/</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/bovi-analytics\.github\.io\/BeastAndBytes\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>